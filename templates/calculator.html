<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elliptic Curve</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/calculator.css') }}">
</head>
<body>
    <!-- Toast Notification Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <div class="loading-text">Calculating...</div>
            <div class="loading-details"></div>
        </div>
    </div>

    <!-- History Panel Overlay -->
    <div id="historyOverlay" class="history-overlay" onclick="closeHistoryPanel()"></div>

    <!-- Sliding History Panel -->
    <div id="historyPanel" class="history-panel">
        <div class="history-panel-header">
            <h2><i class="fa-solid fa-bars panel-title-icon" aria-hidden="true"></i> Menu</h2>
            <button class="history-close-btn" onclick="closeHistoryPanel()" aria-label="Close menu panel">×</button>
        </div>
        <div class="history-panel-content">

            <!-- Menu Search Bar -->
            <div class="menu-search-container">
                <i class="fa-solid fa-search menu-search-icon"></i>
                <input type="text" id="menuSearchInput" class="menu-search-input" placeholder="Search menu..." oninput="filterMenuItems()">
                <button class="menu-search-clear" onclick="clearMenuSearch()" style="display: none;" id="menuSearchClear">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>

            <!-- User Profile Section -->
            <div class="menu-section">
                <div class="menu-section-header">
                        <div class="user-profile-card">
                            <div class="user-avatar"><i class="fa-solid fa-circle-user" aria-hidden="true"></i></div>
                        <div class="user-info">
                            <div class="user-name" id="menuUserName">Guest</div>
                            <div class="user-status" id="menuUserStatus">Not signed in</div>
                        </div>
                    </div>
                    <div class="user-actions">
                        <button id="menuSettingsBtn" class="btn-settings" onclick="toggleAccountSettings()" style="display: none;" title="Account settings" aria-label="Account settings">
                            <i class="fa-solid fa-gear"></i>
                        </button>
                        <button id="menuLogout" class="btn-settings" onclick="doLogout()" style="display: none;" title="Logout" aria-label="Logout">
                            <i class="fa-solid fa-sign-out-alt"></i>
                        </button>
                        <button id="menuAuthBtn" class="btn-auth" onclick="openLoginModal()">Sign In</button>
                    </div>
                </div>
            </div>

            <!-- Account Settings Section (Collapsible) -->
            <div class="menu-section" id="accountSettingsSection" style="display: none;">
                <div class="menu-section-header">
                    <h3 class="menu-section-title">
                        <i class="fa-solid fa-lock menu-title-icon"></i> Account Settings
                    </h3>
                    <p class="menu-section-desc">Manage your account</p>
                </div>
                <div class="menu-grid">
                    <button class="menu-card" onclick="openChangeUsernameModal()" title="Change username" data-menu-text="username change account profile name">
                        <span class="menu-card-icon"><i class="fa-solid fa-user-pen" aria-hidden="true"></i></span>
                        <span class="menu-card-label">Change Username</span>
                        <span class="menu-card-hint">Update profile name</span>
                    </button>
                    <button class="menu-card" onclick="openChangePasswordModal()" title="Change password" data-menu-text="password change security account">
                        <span class="menu-card-icon"><i class="fa-solid fa-key" aria-hidden="true"></i></span>
                        <span class="menu-card-label">Change Password</span>
                        <span class="menu-card-hint">Update security</span>
                    </button>
                </div>
            </div>

            <!-- Quick Actions Section -->
            <div class="menu-section" data-menu-category="quick">
                <div class="menu-section-header" onclick="toggleMenuSection(this)" onkeydown="toggleMenuSection(this)" role="button" tabindex="0" aria-expanded="false">
                    <div class="menu-section-title-wrapper">
                        <h3 class="menu-section-title">
                            <i class="fa-solid fa-bolt menu-title-icon"></i> Quick Actions
                        </h3>
                        <p class="menu-section-desc">Common tasks & settings</p>
                    </div>
                    <i class="fa-solid fa-chevron-down menu-section-chevron"></i>
                </div>
                    <div class="menu-grid menu-section-content" style="display: none;">
                        <button class="menu-card" onclick="toggleTheme()" title="Toggle light/dark theme" data-menu-text="theme dark mode light">
                            <span class="menu-card-icon theme-icon"><i class="fa-solid fa-moon" aria-hidden="true"></i></span>
                        <span class="menu-card-label">Theme</span>
                        <span class="menu-card-hint">Light / Dark mode</span>
                    </button>
                        <button class="menu-card" onclick="showKeyboardHelp()" title="View keyboard shortcuts" data-menu-text="shortcuts keyboard help hotkeys">
                            <span class="menu-card-icon"><i class="fa-solid fa-keyboard" aria-hidden="true"></i></span>
                        <span class="menu-card-label">Shortcuts</span>
                        <span class="menu-card-hint">Keyboard hotkeys</span>
                    </button>
                        <button class="menu-card" onclick="showFormulaReference()" title="Mathematical formulas" data-menu-text="formulas math equations reference">
                            <span class="menu-card-icon"><i class="fa-solid fa-ruler-combined" aria-hidden="true"></i></span>
                        <span class="menu-card-label">Formulas</span>
                        <span class="menu-card-hint">Math reference</span>
                    </button>
                        <button class="menu-card" onclick="exportUnifiedHistory()" title="Export history" data-menu-text="export save download history data">
                            <span class="menu-card-icon"><i class="fa-solid fa-file-export" aria-hidden="true"></i></span>
                        <span class="menu-card-label">Export</span>
                        <span class="menu-card-hint">Download data</span>
                    </button>
                </div>
            </div>

            <!-- Learning & Tutorials Section -->
            <div class="menu-section" data-menu-category="learning">
                <div class="menu-section-header" onclick="toggleMenuSection(this)" onkeydown="toggleMenuSection(this)" role="button" tabindex="0" aria-expanded="false">
                    <div class="menu-section-title-wrapper">
                        <h3 class="menu-section-title">
                            <i class="fa-solid fa-graduation-cap menu-title-icon"></i> Learning & Tutorials
                        </h3>
                        <p class="menu-section-desc">Master ECC concepts</p>
                    </div>
                    <i class="fa-solid fa-chevron-down menu-section-chevron"></i>
                </div>
                <div class="menu-grid menu-section-content" style="display: none;">
                    <button class="menu-card" onclick="startTutorial('initialization')" title="Learn curve initialization" data-menu-text="tutorial initialization curve setup learn">
                        <span class="menu-card-icon"><i class="fa-solid fa-graduation-cap" aria-hidden="true"></i></span>
                        <span class="menu-card-label">Init Tutorial</span>
                        <span class="menu-card-hint">Curve setup guide</span>
                    </button>
                    <button class="menu-card" onclick="startTutorial('point_addition')" title="Learn point addition" data-menu-text="tutorial addition points learn arithmetic">
                        <span class="menu-card-icon"><i class="fa-solid fa-book-open" aria-hidden="true"></i></span>
                        <span class="menu-card-label">Addition Tutorial</span>
                        <span class="menu-card-hint">Point arithmetic</span>
                    </button>
                    <button class="menu-card" onclick="startTutorial('scalar_multiplication')" title="Learn scalar multiplication" data-menu-text="tutorial multiplication scalar multiplication learn">
                        <span class="menu-card-icon"><i class="fa-solid fa-chalkboard-teacher" aria-hidden="true"></i></span>
                        <span class="menu-card-label">Multiply Tutorial</span>
                        <span class="menu-card-hint">Scalar multiplication</span>
                    </button>
                    <button class="menu-card" onclick="showPresetsLibrary()" title="Manage curve presets" data-menu-text="presets library save load curves templates">
                        <span class="menu-card-icon"><i class="fa-solid fa-bookmark" aria-hidden="true"></i></span>
                        <span class="menu-card-label">Presets Library</span>
                        <span class="menu-card-hint">Save custom curves</span>
                    </button>
                </div>
            </div>

            <!-- Advanced Features Section -->
            <div class="menu-section" data-menu-category="advanced">
                <div class="menu-section-header" onclick="toggleMenuSection(this)" onkeydown="toggleMenuSection(this)" role="button" tabindex="0" aria-expanded="false">
                    <div class="menu-section-title-wrapper">
                        <h3 class="menu-section-title">
                            <i class="fa-solid fa-flask menu-title-icon"></i> Advanced Features
                        </h3>
                        <p class="menu-section-desc">Cryptographic demonstrations</p>
                    </div>
                    <i class="fa-solid fa-chevron-down menu-section-chevron"></i>
                </div>
                <div class="menu-grid menu-section-content" style="display: none;">
                    <button class="menu-card" onclick="classifyPoints()" title="Classify curve points" data-menu-text="classify point types curve analysis">
                        <span class="menu-card-icon"><i class="fa-solid fa-layer-group" aria-hidden="true"></i></span>
                        <span class="menu-card-label">Classify</span>
                        <span class="menu-card-hint">Analyze points</span>
                    </button>
                    <button class="menu-card" onclick="demonstrateDiscreteLog()" title="Discrete logarithm problem" data-menu-text="discrete log problem attack brute force">
                        <span class="menu-card-icon"><i class="fa-solid fa-calculator" aria-hidden="true"></i></span>
                        <span class="menu-card-label">Discrete Log</span>
                        <span class="menu-card-hint">Attack simulation</span>
                    </button>
                    <button class="menu-card" onclick="showWhyItWorksModal()" title="Learn how ECC works" data-menu-text="why ecc elliptic curve security strength">
                        <span class="menu-card-icon"><i class="fa-solid fa-lightbulb" aria-hidden="true"></i></span>
                        <span class="menu-card-label">Why It Works</span>
                        <span class="menu-card-hint">Security explained</span>
                    </button>
                </div>
            </div>

            <!-- Utility Tools Section -->
            <div class="menu-section" data-menu-category="utility">
                <div class="menu-section-header" onclick="toggleMenuSection(this)" onkeydown="toggleMenuSection(this)" role="button" tabindex="0" aria-expanded="false">
                    <div class="menu-section-title-wrapper">
                        <h3 class="menu-section-title">
                            <i class="fa-solid fa-wrench menu-title-icon"></i> Utility Tools
                        </h3>
                        <p class="menu-section-desc">Export & analysis tools</p>
                    </div>
                    <i class="fa-solid fa-chevron-down menu-section-chevron"></i>
                </div>
                <div class="menu-grid menu-section-content" style="display: none;">
                    <button class="menu-card" onclick="generateTestVector()" title="Generate test vector" data-menu-text="test vector generate example sample">
                        <span class="menu-card-icon"><i class="fa-solid fa-vial" aria-hidden="true"></i></span>
                        <span class="menu-card-label">Test Vector</span>
                        <span class="menu-card-hint">Sample data</span>
                    </button>
                    <button class="menu-card" onclick="copyCurveParameters()" title="Copy curve parameters" data-menu-text="copy parameters clipboard curve data">
                        <span class="menu-card-icon"><i class="fa-solid fa-copy" aria-hidden="true"></i></span>
                        <span class="menu-card-label">Copy Params</span>
                        <span class="menu-card-hint">Clipboard</span>
                    </button>
                    <button class="menu-card" onclick="downloadPointList()" title="Download point list" data-menu-text="download export points csv json file">
                        <span class="menu-card-icon"><i class="fa-solid fa-download" aria-hidden="true"></i></span>
                        <span class="menu-card-label">Download</span>
                        <span class="menu-card-hint">Point list</span>
                    </button>
                </div>
            </div>

            <!-- History Section -->
            <div class="menu-section">
                <div class="menu-section-title-row" onclick="toggleMenuSection(this)" onkeydown="toggleMenuSection(this)" role="button" tabindex="0" aria-expanded="false">
                        <div class="menu-section-title-wrapper">
                            <h3 class="menu-section-title"><i class="fa-solid fa-scroll menu-title-icon" aria-hidden="true"></i> History</h3>
                        </div>
                        <div class="menu-section-actions">
                            <button class="icon-btn" onclick="refreshUnifiedHistory(event)" title="Refresh history">
                                <span aria-hidden="true"><i class="fa-solid fa-arrows-rotate"></i></span>
                            </button>
                            <button class="icon-btn" onclick="clearUnifiedHistory(event)" title="Clear history">
                                <span aria-hidden="true"><i class="fa-solid fa-trash-can"></i></span>
                            </button>
                            <i class="fa-solid fa-chevron-down menu-section-chevron"></i>
                        </div>
                    </div>
                <div id="unifiedHistoryList" class="history-list menu-section-content" style="display: none;"></div>
            </div>

        </div>
    </div>

    <div class="container">
        <div class="header">
            <button class="info-btn" onclick="toggleAboutModal()" title="About & Help" aria-label="About and help">
                <span class="info-icon"><i class="fa-solid fa-circle-info" aria-hidden="true"></i></span>
            </button>
            <h1>Elliptic Curve</h1>
            <div class="header-buttons">
                <button class="history-toggle" onclick="toggleHistoryPanel()" title="Menu" aria-label="Open menu panel">
                    <div class="hamburger-line"></div>
                    <div class="hamburger-line"></div>
                    <div class="hamburger-line"></div>
                </button>
            </div>
        </div>

        <!-- Auth Overlay -->
        <div id="authOverlay" class="auth-overlay">
            <div class="auth-card">
                <div style="text-align:center;">
                    <div class="auth-icon" aria-hidden="true"><i class="fa-solid fa-lock" aria-hidden="true"></i></div>
                    <div class="auth-title">Sign in</div>
                    <div class="auth-sub">Access your elliptic curve workspace.</div>
                </div>
                <div class="auth-form" id="loginForm">
                    <div class="auth-field">
                        <svg class="auth-ico" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 12c2.7 0 5-2.3 5-5s-2.3-5-5-5-5 2.3-5 5 2.3 5 5 5zm0 2c-3.3 0-10 1.7-10 5v3h20v-3c0-3.3-6.7-5-10-5z"/></svg>
                        <input id="loginUsername" type="text" placeholder="Username">
                        <div id="loginUsernameErr" class="field-error" style="display:none;"></div>
                    </div>
                    <div class="auth-field">
                        <svg class="auth-ico" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 17a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm6-6V9a6 6 0 1 0-12 0v2H4v10h16V11h-2zm-8-2a4 4 0 1 1 8 0v2H10V9z"/></svg>
                        <input id="loginPassword" type="password" placeholder="Password">
                        <div id="loginPasswordErr" class="field-error" style="display:none;"></div>
                    </div>
                    <div class="auth-right-row">
                        <a class="auth-right-link" href="#" onclick="showForgotPassword(event)">Forgot password?</a>
                    </div>
                    <button class="btn-primary-dark" onclick="submitLoginCard()">Get Started</button>
                    <div class="auth-sep"><div class="line"></div><div class="txt">Or</div><div class="line"></div></div>
                    <div class="btn-row">
                        <button class="btn-pill secondary" onclick="openSignupPage()">Create an account</button>
                        <button class="btn-pill ghost" onclick="continueAsGuestCard()">Continue as guest</button>
                    </div>
                    <div id="authMsgOverlay" class="auth-msg" aria-live="polite"></div>
                </div>

                <div class="auth-form" id="forgotForm" style="display:none;">
                    <div class="auth-field">
                        <input id="forgotUsername" type="text" placeholder="Username">
                        <div id="forgotUsernameErr" class="field-error" style="display:none;"></div>
                    </div>
                    <button class="btn-primary-dark" onclick="submitForgotPassword()">Send reset link</button>
                    <button class="btn-pill ghost" type="button" onclick="cancelForgotPassword()">Back to sign in</button>
                    <div id="forgotMsg" class="auth-msg" aria-live="polite"></div>
                </div>
            </div>
        </div>
        
        <div class="content">

            <!-- Curve Type Selector, Encryption Selector, and Demonstrations Selector -->
            <div class="selector-row">
                <div class="curve-selector-dropdown">
                    <button class="curve-selector-btn" id="curveSelectorBtn">
                        <span>Curve view</span>
                        <span class="dropdown-arrow">▼</span>
                    </button>
                    <div class="curve-dropdown-menu">
                        <div class="curve-dropdown-item active" onclick="selectCurveType('fpTab', 'Curve over Fp')">Curve over Fp</div>
                        <div class="curve-dropdown-item" onclick="selectCurveType('realTab', 'Curve over ℝ')">Curve over ℝ</div>
                    </div>
                </div>

                <div class="curve-selector-dropdown">
                    <button class="curve-selector-btn" id="encryptionSelectorBtn">
                        <span>Crypto workflow</span>
                        <span class="dropdown-arrow">▼</span>
                    </button>
                    <div class="curve-dropdown-menu">
                        <div class="curve-dropdown-item active" onclick="selectEncryptionPane('encryptInitPane', event)">Initialization</div>
                    </div>
                </div>

                <div class="curve-selector-dropdown">
                    <button class="curve-selector-btn" id="demonstrationSelectorBtn">
                        <span>Interactive demos</span>
                        <span class="dropdown-arrow">▼</span>
                    </button>
                    <div class="curve-dropdown-menu">
                        <div class="curve-dropdown-item active" onclick="selectDemonstrationPane('dhDemoPane', event)">Diffie-Hellman</div>
                        <div class="curve-dropdown-item" onclick="selectDemonstrationPane('discreteLogPane', event)">Discrete Logarithm</div>
                    </div>
                </div>

            </div>

            <!-- About Modal -->
            <div id="aboutModal" class="about-modal">
                <div class="about-modal-overlay" onclick="closeAboutModal()"></div>
                <div class="about-modal-content">
                    <button class="about-modal-close" onclick="closeAboutModal()" aria-label="Close about">×</button>
                    <div class="about-modal-body">
                <div class="panel full-width">
                    <h2>About</h2>
                    <p style="margin-bottom: 12px;">
                        Every UI panel, canvas, and API call here is focused on making elliptic-curve cryptography approachable without sacrificing rigor. You explore curves, run demonstrations, encrypt/decrypt data, and inspect the full history from a single dashboard.
                    </p>

                    <div class="math-formula">y² = x³ + ax + b (mod p)</div>

                    <h3 style="margin-top:16px;">Curve Exploration Workflow</h3>
                    <ul style="margin-left: 20px; line-height: 1.8;">
                        <li><strong>Initialization:</strong> Select a preset curve or enter custom <code>a</code>, <code>b</code>, and prime <code>p</code>. The system calculates the full finite field group (including the point at infinity) so you can map the geometry.</li>
                        <li><strong>Visualization:</strong> Two synchronized canvases plot all points with optional labels, color-coded highlights, and click-to-select behaviour so you can interrogate the group law visually.</li>
                        <li><strong>Point Operations:</strong> The addition and scalar multiplication panels guide you through the algebraic steps, show animated point movement, and keep transcripts ready to copy as JSON/LaTeX.</li>
                        <li><strong>Real/Finite Comparison:</strong> The ℝ tab mirrors the workflow over the reals, while the finite field tab stays true to modular arithmetic, letting you contrast the geometry.</li>
                    </ul>

                    <h3 style="margin-top:16px;">Demonstrations &amp; Learning</h3>
                    <ul style="margin-left: 20px; line-height: 1.8;">
                        <li><strong>Diffie-Hellman:</strong> Run a live handshake using the current curve, watch Alice/Bob compute shared secrets, and scrub through animated steps with the slider, auto-scroll, and canvas highlights.</li>
                        <li><strong>Discrete Logarithm:</strong> Select a scalar <code>k</code>, optionally prefer Baby-step Giant-step, and the demo exhausts attempts with metadata, time estimates, and a human-friendly summary.</li>
                        <li><strong>Tutorial player:</strong> Contextual tutorials are available from the menu, each explaining curve initialization, point addition, and other core concepts with inline animations.</li>
                        <li><strong>Interactive explanations:</strong> Expandable cards describe associativity, identity, inverses, smoothness, and why ECC is hard—each tied to animations inside the visualization area.</li>
                    </ul>

                    <h3 style="margin-top:16px;">Encryption &amp; History</h3>
                    <ul style="margin-left: 20px; line-height: 1.8;">
                        <li><strong>Encryption workflow:</strong> Generate ephemeral keys, encrypt text or uploaded files, and follow the step-by-step animation that draws R/S points, ciphertext batches, and shared secrets.</li>
                        <li><strong>Decryption workflow:</strong> Paste or drop ciphertext, decrypt with the stored private key, and see how the shared secret reassembles the plaintext; a guided "show steps" view mirrors the same animation.</li>
                        <li><strong>History database:</strong> Every curve initialization, parameter change, point addition/multiplication, encryption, and decryption is logged into the SQLite history table. You can export operations, replay demonstrations, and copy JSON summaries directly from the sliding history panel.</li>
                    </ul>

                    <h3 style="margin-top:16px;">Advanced Utilities</h3>
                    <ul style="margin-left: 20px; line-height: 1.8;">
                        <li><strong>Point classification:</strong> Use the advanced API to identify generators, torsion points, and their orders—perfect for understanding subgroup structure.</li>
                        <li><strong>Preset management:</strong> The dropdown keeps curated educational curves and lets you save custom presets with descriptions for future work.</li>
                        <li><strong>Exports:</strong> Generate test vectors, download point lists as CSV/JSON, or copy curve parameters/test results with a single click.</li>
                        <li><strong>Theme &amp; shortcuts:</strong> Toggle dark/light mode with the floating menu icon, use keyboard helpers, and watch toasts confirm actions.</li>
                    </ul>

                    <h3 style="margin-top:16px;">Why Elliptic Curves?</h3>
                    <p style="margin: 8px 0;">
                        These curves form a compact, high-security group where the discrete logarithm problem remains hard. This interface makes every layer—from the algebra to encrypted messages and tutorials—visible so you can both experiment and explain ECC confidently.
                    </p>
                </div>
                    </div>
                </div>
            </div>

            <!-- Change Username Modal -->
            <div id="changeUsernameModal" class="account-modal">
                <div class="account-modal-overlay" onclick="closeChangeUsernameModal()"></div>
                <div class="account-modal-content">
                    <button class="account-modal-close" onclick="closeChangeUsernameModal()" aria-label="Close">×</button>
                    <div class="account-modal-body">
                        <div class="account-modal-icon">
                            <i class="fa-solid fa-user-pen"></i>
                        </div>
                        <h2>Change Username</h2>
                        <p class="account-modal-subtitle">Update your profile name</p>

                        <div class="account-form-group">
                            <label for="currentUsername">Current Username</label>
                            <div class="username-display" id="currentUsernameDisplay">username</div>
                        </div>

                        <div class="account-form-group">
                            <label for="newUsername">New Username</label>
                            <input type="text" id="newUsername" placeholder="Enter new username" maxlength="50">
                            <small class="form-hint">Username must be 3-50 characters</small>
                        </div>

                        <div class="account-form-group">
                            <label for="usernamePassword">Password (for confirmation)</label>
                            <input type="password" id="usernamePassword" placeholder="Enter your password">
                            <small class="form-hint">Confirm with your password</small>
                        </div>

                        <div id="usernameError" class="account-error" style="display: none;"></div>

                        <div class="account-modal-actions">
                            <button class="btn-secondary" onclick="closeChangeUsernameModal()">Cancel</button>
                            <button class="btn-primary" onclick="submitChangeUsername()">Update Username</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Change Password Modal -->
            <div id="changePasswordModal" class="account-modal">
                <div class="account-modal-overlay" onclick="closeChangePasswordModal()"></div>
                <div class="account-modal-content">
                    <button class="account-modal-close" onclick="closeChangePasswordModal()" aria-label="Close">×</button>
                    <div class="account-modal-body">
                        <div class="account-modal-icon">
                            <i class="fa-solid fa-key"></i>
                        </div>
                        <h2>Change Password</h2>
                        <p class="account-modal-subtitle">Update your account security</p>

                        <div class="account-form-group">
                            <label for="currentPassword">Current Password</label>
                            <input type="password" id="currentPassword" placeholder="Enter current password">
                        </div>

                        <div class="account-form-group">
                            <label for="newPassword">New Password</label>
                            <input type="password" id="newPassword" placeholder="Enter new password">
                            <small class="form-hint">Password must be at least 8 characters</small>
                        </div>

                        <div class="account-form-group">
                            <label for="confirmPassword">Confirm Password</label>
                            <input type="password" id="confirmPassword" placeholder="Confirm new password">
                            <small class="form-hint">Passwords must match</small>
                        </div>

                        <div class="password-strength" id="passwordStrength">
                            <div class="strength-bar"></div>
                            <span class="strength-text">Password strength: <span id="strengthLevel">—</span></span>
                        </div>

                        <div id="passwordError" class="account-error" style="display: none;"></div>

                        <div class="account-modal-actions">
                            <button class="btn-secondary" onclick="closeChangePasswordModal()">Cancel</button>
                            <button class="btn-primary" onclick="submitChangePassword()">Update Password</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Real Curve (ℝ) Tab -->
            <div id="realTab" class="tab-pane">

                <div id="realInitPane" class="subtab-pane active">
                    <div class="panel">
                        <h2>Define Curve</h2>
                        <div class="form-group">
                            <div class="inline-inputs">
                                <div>
                                    <label for="realParamA">a</label>
                                    <input type="number" step="any" id="realParamA" value="-1" placeholder="a">
                                </div>
                                <div>
                                    <label for="realParamB">b</label>
                                    <input type="number" step="any" id="realParamB" value="1" placeholder="b">
                                </div>
                            </div>
                        </div>
                        <button onclick="initRealCurve()">Initialize Curve</button>

                        <div style="margin-top: 20px;">
                            <h3 style="color: #888; margin-bottom: 10px;">Operations</h3>
                            <button onclick="switchSubtab('real','realAddPane')" style="margin-bottom: 10px; width: 100%;">Point Addition</button>
                            <button onclick="switchSubtab('real','realMulPane')" style="width: 100%;">Scalar Multiplication</button>
                        </div>
                    </div>
                    <div class="panel">
                        <h2>Visualization</h2>
                        <p style="margin-bottom: 15px; color: #888;">Smooth curve plot over real numbers</p>
                        <canvas id="realCurveCanvas" width="600" height="500"></canvas>
                        <label style="display:block; margin-top:8px; color:#aaa; font-size:0.95em;">
                            <input id="realShowLabels" type="checkbox" checked onchange="redrawRealCanvases()"> Show point labels
                        </label>
                    </div>
                </div>

                <div id="realAddPane" class="subtab-pane">
                    <div class="panel">
                        <button onclick="switchSubtab('real','realInitPane')" style="margin-bottom: 15px;">← Back to Initialization</button>
                        <h2>Point Addition (ℝ)</h2>
                        <p style="margin-bottom: 15px; color: #888;">Geometric chord/tangent visualization</p>
                        <div class="form-group">
                            <div class="inline-inputs">
                                <div>
                                    <label for="realP1X">P.x</label>
                                    <input type="number" step="any" id="realP1X" placeholder="x₁">
                                </div>
                                <div>
                                    <label for="realP1Y">P.y</label>
                                    <input type="number" step="any" id="realP1Y" placeholder="y₁">
                                </div>
                                <div>
                                    <label for="realSelectMode">Pick Mode</label>
                                    <select id="realSelectMode">
                                        <option value="P">Select P</option>
                                        <option value="Q">Select Q</option>
                                    </select>
                                </div>
                            </div>
                            <div class="point-status" id="realPoint1Status">Enter both coordinates</div>
                        </div>
                        <div class="form-group">
                            <div class="inline-inputs">
                                <div>
                                    <label for="realP2X">Q.x</label>
                                    <input type="number" step="any" id="realP2X" placeholder="x₂">
                                </div>
                                <div>
                                    <label for="realP2Y">Q.y</label>
                                    <input type="number" step="any" id="realP2Y" placeholder="y₂">
                                </div>
                                <div>
                                    <label>&nbsp;</label>
                                    <button onclick="addPointsReal()">Calculate P + Q</button>
                                </div>
                            </div>
                            <div class="point-status" id="realPoint2Status">Enter both coordinates</div>
                        </div>
                        <div id="realAdditionResult"></div>
                    </div>
                    <div class="panel">
                        <h2>Visualization</h2>
                        <p style="margin-bottom: 15px; color: #888;">Click on the curve to set P or Q</p>
                        <canvas id="realAdditionCanvas" width="600" height="500"></canvas>
                        <label style="display:block; margin-top:8px; color:#aaa; font-size:0.95em;">
                            <input id="realAdditionShowLabels" type="checkbox" checked onchange="drawRealAdditionScene()"> Show point labels
                        </label>
                        <div class="steps-toggle-row">
                            <button id="realAdditionToggleStepsBtn" class="toggle-steps-btn" type="button" onclick="toggleStepsDisplay('realAddition')" data-visible="true">
                                Hide steps
                            </button>
                        </div>
                    </div>
                </div>

                <div id="realMulPane" class="subtab-pane">
                    <div class="panel">
                        <button onclick="switchSubtab('real','realInitPane')" style="margin-bottom: 15px;">← Back to Initialization</button>
                        <h2>Scalar Multiplication (ℝ)</h2>
                        <p style="margin-bottom: 15px; color: #888;">Follow k × P along the curve</p>
                        <div class="form-group">
                            <div class="inline-inputs">
                                <div>
                                    <label for="realK">k</label>
                                    <input type="number" id="realK" value="3" placeholder="k">
                                </div>
                                <div>
                                    <label for="realMulPX">P.x</label>
                                    <input type="number" step="any" id="realMulPX" placeholder="x">
                                </div>
                                <div>
                                    <label for="realMulPY">P.y</label>
                                    <input type="number" step="any" id="realMulPY" placeholder="y">
                                </div>
                            </div>
                            <div class="point-status" id="realScalarPointStatus">Enter both coordinates</div>
                        </div>
                        <button onclick="scalarMultiplyReal()">Calculate k × P</button>
                        <div id="realScalarResult"></div>
                    </div>
                    <div class="panel">
                        <h2>Visualization</h2>
                        <p style="margin-bottom: 15px; color: #888;">Visualization</p>
                        <canvas id="realMultiplicationCanvas" width="600" height="500"></canvas>
                        <label style="display:block; margin-top:8px; color:#aaa; font-size:0.95em;">
                            <input id="realMultiplicationShowLabels" type="checkbox" checked onchange="renderRealScalarAll()"> Show point labels
                        </label>
                        <div class="steps-toggle-row">
                            <button id="realScalarToggleStepsBtn" class="toggle-steps-btn" type="button" onclick="toggleStepsDisplay('realScalar')" data-visible="true">
                                Hide steps
                            </button>
                        </div>
                        <div id="realAnimControls" class="anim-controls" style="display:none;"></div>
                    </div>
                </div>

            </div>

            <!-- Curve over Fp Tab -->
            <div id="fpTab" class="tab-pane active">

                <div id="fpInitPane" class="subtab-pane active">
                    <div class="panel">
                        <h2>Define Curve</h2>
                        <div class="form-group">
                            <label for="curvePreset">Preset Curves</label>
                            <select id="curvePreset" onchange="loadCurvePreset(this.value)">
                                <option value="custom">Custom</option>
                                <optgroup label="Famous Curves (Simplified)">
                                    <option value="secp256k1">secp256k1-like (Bitcoin)</option>
                                    <option value="p256">P-256-like (NIST)</option>
                                </optgroup>
                                <optgroup label="Small Examples">
                                    <option value="e23">E₂₃(1,1) - Tiny example</option>
                                    <option value="e31">E₃₁(2,3) - Small example</option>
                                    <option value="e47">E₄₇(5,7) - Medium example</option>
                                    <option value="e97" selected>E₉₇(2,3) - Default</option>
                                    <option value="e127">E₁₂₇(1,2) - Larger example</option>
                                </optgroup>
                            </select>
                            <small id="curveDescription" class="curve-description"></small>
                        </div>
                        <div class="form-group">
                            <div class="inline-inputs">
                                <div>
                                    <label for="paramA">a</label>
                                    <input type="number" id="paramA" value="2" placeholder="a">
                                </div>
                                <div>
                                    <label for="paramB">b</label>
                                    <input type="number" id="paramB" value="3" placeholder="b">
                                </div>
                                <div>
                                    <label for="paramP">p (prime)</label>
                                    <input type="number" id="paramP" value="97" placeholder="p">
                                </div>
                            </div>
                        </div>
                        <button onclick="findAllPoints()">Find All Points on Curve</button>

                        <div style="margin-top: 20px;">
                            <h3 style="color: #888; margin-bottom: 10px;">Operations</h3>
                            <button onclick="switchSubtab('fp','fpAddPane')" style="margin-bottom: 10px; width: 100%;">Point Addition</button>
                            <button onclick="switchSubtab('fp','fpMulPane')" style="width: 100%; margin-bottom: 10px;">Scalar Multiplication</button>
                        </div>
                    </div>
                    <div class="panel">
                        <h2>Points</h2>
                        <div id="curveInfo"></div>
                        <div id="pointsList"></div>

                    </div>
                </div>

                <div id="fpAddPane" class="subtab-pane">
                    <div class="panel">
                        <button onclick="switchSubtab('fp','fpInitPane')" style="margin-bottom: 15px;">← Back to Initialization</button>
                        <h2>Point Addition</h2>
                        <p style="margin-bottom: 15px; color: #888;">Add two points: P + Q = R</p>
                        <div class="form-group">
                            <label for="point1Select">Point P</label>
                            <select id="point1Select"><option value="">Select Point P</option></select>
                        </div>
                        <div class="form-group">
                            <label for="point2Select">Point Q</label>
                            <select id="point2Select"><option value="">Select Point Q</option></select>
                        </div>
                        <button onclick="addPoints()">Calculate P + Q</button>
                        <div id="additionResult"></div>
                    </div>
                    <div class="panel">
                        <h2>Visualization</h2>
                        <p style="margin-bottom: 15px; color: #888;">Points on the elliptic curve (mod p)</p>
                        <canvas id="additionCanvas" width="600" height="500"></canvas>
                        <label style="display:block; margin-top:8px; color:#aaa; font-size:0.95em;">
                            <input id="additionShowLabels" type="checkbox" checked onchange="redrawAdditionCanvas()"> Show point labels
                        </label>
                        <div class="steps-toggle-row">
                            <button id="additionToggleStepsBtn" class="toggle-steps-btn" type="button" onclick="toggleStepsDisplay('addition')" data-visible="true">
                                Hide steps
                            </button>
                        </div>
                        <div id="additionPointInfo" class="point-info" aria-live="polite"></div>
                    </div>
                </div>

                <div id="fpMulPane" class="subtab-pane">
                    <div class="panel">
                        <button onclick="switchSubtab('fp','fpInitPane')" style="margin-bottom: 15px;">← Back to Initialization</button>
                        <h2>Scalar Multiplication</h2>
                        <p style="margin-bottom: 15px; color: #888;">Multiply a point by a scalar: k × P</p>
                        <div class="form-group">
                            <label for="scalarPointSelect">Point P</label>
                            <select id="scalarPointSelect"><option value="">Select Point P</option></select>
                        </div>
                        <div class="form-group">
                            <label for="scalarValue">Scalar k</label>
                            <input type="number" id="scalarValue" value="3" placeholder="k">
                        </div>
                        <button onclick="scalarMultiply()">Calculate k × P</button>
                        <div id="scalarResult"></div>
                    </div>
                    <div class="panel">
                        <h2>Visualization</h2>
                        <p style="margin-bottom: 15px; color: #888;">Visualization</p>
                        <canvas id="multiplicationCanvas" width="600" height="500"></canvas>
                        <label style="display:block; margin-top:8px; color:#aaa; font-size:0.95em;">
                            <input id="multiplicationShowLabels" type="checkbox" checked onchange="renderFpScalarAll()"> Show point labels
                        </label>
                        <div class="steps-toggle-row">
                            <button id="scalarToggleStepsBtn" class="toggle-steps-btn" type="button" onclick="toggleStepsDisplay('scalar')" data-visible="true">
                                Hide steps
                            </button>
                        </div>
                        <div id="multiplicationPointInfo" class="point-info" aria-live="polite"></div>
                        <div id="animationControls" class="anim-controls" style="display:none;">
                            <button id="prevStepBtn" onclick="prevScalarStep()" disabled>Prev</button>
                            <button id="playPauseBtn" onclick="toggleScalarAnimation()" disabled>Play</button>
                            <input id="stepSlider" type="range" min="0" max="0" value="0" disabled oninput="onScalarSlider(this.value)">
                            <button id="nextStepBtn" onclick="nextScalarStep()" disabled>Next</button>
                            <span id="stepLabel" class="step-label">0/0</span>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Demonstrations Tab -->
            <div id="demonstrationsTab" class="tab-pane">
                <div id="dhDemoPane" class="subtab-pane active">
                    <div class="panel">
                        <div class="dh-header">
                            <div class="dh-icon-wrapper">
                                <i class="fa-solid fa-key"></i>
                            </div>
                            <div>
                                <h2 style="margin: 0 0 8px 0;">Diffie-Hellman Key Exchange</h2>
                                <p style="margin: 0; color: var(--text-secondary); line-height: 1.5;">
                                    Watch how Alice and Bob establish a shared secret over a public channel using elliptic curve cryptography
                                </p>
                            </div>
                        </div>

                        <div class="dh-info-box">
                            <i class="fa-solid fa-lightbulb"></i>
                            <div>
                                <strong>How it works:</strong> Both parties compute a shared secret without ever transmitting it.
                                An eavesdropper can see the public keys but cannot determine the shared secret.
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="dhCurvePreset">
                                <i class="fa-solid fa-bookmark" style="margin-right: 6px; color: var(--accent-primary);"></i>
                                Choose a Preset Curve
                            </label>
                            <select id="dhCurvePreset" onchange="loadDHPreset(this.value)">
                                <option value="e23">E₂₃(1,1) - Tiny example (Fast demo)</option>
                                <option value="e31">E₃₁(2,3) - Small example</option>
                                <option value="e47" selected>E₄₇(5,7) - Medium example (Recommended)</option>
                                <option value="e97">E₉₇(2,3) - Default (More points)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label style="font-weight: 500;">
                                <i class="fa-solid fa-sliders" style="margin-right: 6px; color: var(--accent-primary);"></i>
                                Curve Parameters
                            </label>
                            <div class="inline-inputs">
                                <div>
                                    <label for="dhParamA">a</label>
                                    <input type="number" id="dhParamA" value="5" placeholder="a">
                                </div>
                                <div>
                                    <label for="dhParamB">b</label>
                                    <input type="number" id="dhParamB" value="7" placeholder="b">
                                </div>
                                <div>
                                    <label for="dhParamP">p (prime)</label>
                                    <input type="number" id="dhParamP" value="47" placeholder="p">
                                </div>
                            </div>
                            <small style="display: block; margin-top: 8px; color: var(--text-muted);">
                                Curve equation: y² ≡ x³ + ax + b (mod p)
                            </small>
                        </div>

                        <button onclick="runDiffieHellmanDemo()" class="dh-start-btn">
                            <i class="fa-solid fa-play"></i>
                            Start Key Exchange Demo
                        </button>

                        <div id="dhDemoResult"></div>
                    </div>
                    <div class="panel">
                        <div class="dh-viz-header">
                            <h2 style="margin: 0; display: flex; align-items: center; gap: 10px;">
                                <i class="fa-solid fa-chart-line"></i>
                                Interactive Visualization
                            </h2>
                            <p style="margin: 8px 0 0; color: var(--text-secondary);">
                                Follow along as the key exchange happens step by step
                            </p>
                        </div>

                        <div class="dh-canvas-wrapper">
                            <canvas id="dhCanvas" width="620" height="420"></canvas>
                            <div id="dhCanvasHint" class="dh-canvas-hint">
                                <i class="fa-solid fa-circle-info"></i>
                                <span>Click "Start Key Exchange Demo" above to begin the visualization</span>
                            </div>
                        </div>

                        <div id="dhAnimControls" class="dh-anim-controls">
                            <button id="dhPrevBtn" onclick="prevDHStep()" class="dh-control-btn" title="Previous step">
                                <i class="fa-solid fa-backward-step"></i>
                                <span>Previous</span>
                            </button>
                            <button id="dhPlayBtn" onclick="playDHAnimation()" class="dh-control-btn dh-play-btn" title="Play animation">
                                <i class="fa-solid fa-play"></i>
                                <span>Play</span>
                            </button>
                            <div class="dh-slider-wrapper">
                                <input id="dhStepSlider" type="range" min="0" max="0" value="0" oninput="setDHStep(this.value)">
                                <span class="dh-step-label" id="dhStepLabel">0/0</span>
                            </div>
                            <button id="dhNextBtn" onclick="nextDHStep()" class="dh-control-btn" title="Next step">
                                <span>Next</span>
                                <i class="fa-solid fa-forward-step"></i>
                            </button>
                        </div>

                        <div class="dh-steps-wrapper">
                            <h3 style="margin: 0 0 12px 0; color: var(--text-primary); font-size: 1.05em;">
                                <i class="fa-solid fa-list-ol" style="margin-right: 8px; color: var(--accent-primary);"></i>
                                Step-by-Step Breakdown
                            </h3>
                            <div id="dhStepsContainer" class="dh-steps-scroll"></div>
                        </div>
                    </div>
                </div>

                <div id="discreteLogPane" class="subtab-pane">
                    <div class="panel">
                        <div style="text-align: center; margin-bottom: 30px;">
                            <h2 style="margin-bottom: 10px; color: var(--text-primary);">Elliptic Curve Discrete Logarithm Problem</h2>
                            <p style="color: var(--text-secondary); font-size: 1.05em; line-height: 1.6; max-width: 600px; margin: 0 auto;">
                                This interactive demo shows why elliptic curve cryptography is secure.
                                <br>Computing Q = k×G is easy, but finding k from Q is hard!
                            </p>
                        </div>

                        <!-- Progress Indicator -->
                        <div style="display: flex; justify-content: space-between; margin-bottom: 30px; gap: 10px;">
                            <div id="dlogProgress1" style="flex: 1; text-align: center; padding: 12px; background: rgba(59, 130, 246, 0.2); border-radius: 8px; border: 3px solid #3b82f6; box-shadow: 0 2px 8px rgba(59, 130, 246, 0.15);">
                                <div style="font-size: 1.5em; margin-bottom: 4px; color: var(--text-primary);">①</div>
                                <div style="font-size: 0.85em; font-weight: 600; color: #3b82f6;">Setup Curve</div>
                            </div>
                            <div id="dlogProgress2" style="flex: 1; text-align: center; padding: 12px; background: rgba(156, 163, 175, 0.15); border-radius: 8px; border: 3px solid #9ca3af; opacity: 0.6;">
                                <div style="font-size: 1.5em; margin-bottom: 4px; color: var(--text-primary);">②</div>
                                <div style="font-size: 0.85em; font-weight: 600; color: #6b7280;">Compute Q</div>
                            </div>
                            <div id="dlogProgress3" style="flex: 1; text-align: center; padding: 12px; background: rgba(156, 163, 175, 0.15); border-radius: 8px; border: 3px solid #9ca3af; opacity: 0.6;">
                                <div style="font-size: 1.5em; margin-bottom: 4px; color: var(--text-primary);">③</div>
                                <div style="font-size: 0.85em; font-weight: 600; color: #6b7280;">Attack</div>
                            </div>
                        </div>

                        <!-- Step 1: Initialize Curve -->
                        <div id="dlogStep1Panel" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(59, 130, 246, 0.08) 100%);
                            padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 3px solid rgba(59, 130, 246, 0.5); box-shadow: 0 2px 12px rgba(59, 130, 246, 0.12);">

                            <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                <div style="width: 36px; height: 36px; background: #3b82f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 12px; font-weight: bold; font-size: 1.2em; color: white; box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);">①</div>
                                <div>
                                    <h3 style="margin: 0; color: #2563eb; font-size: 1.1em; font-weight: 700;">Setup Elliptic Curve</h3>
                                    <p style="margin: 2px 0 0 0; color: var(--text-secondary); font-size: 0.9em;">Choose curve parameters and find a base point G</p>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="dlogCurvePreset" style="font-weight: 500;">Quick Select Curve</label>
                                <select id="dlogCurvePreset" onchange="loadDLogPreset(this.value)" style="font-size: 0.95em;">
                                    <option value="e23">E₂₃(1,1) - Tiny (23 points) - Great for learning!</option>
                                    <option value="e31">E₃₁(2,3) - Small (39 points) - Fast demo</option>
                                    <option value="e47" selected>E₄₇(5,7) - Medium (51 points) - Recommended</option>
                                    <option value="e97">E₉₇(2,3) - Larger (100 points) - More realistic</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label style="font-weight: 500; margin-bottom: 8px; display: block;">Or Customize Parameters</label>
                                <div class="inline-inputs">
                                    <div>
                                        <label for="dlogParamA">a</label>
                                        <input type="number" id="dlogParamA" value="5" placeholder="a">
                                    </div>
                                    <div>
                                        <label for="dlogParamB">b</label>
                                        <input type="number" id="dlogParamB" value="7" placeholder="b">
                                    </div>
                                    <div>
                                        <label for="dlogParamP">p (prime)</label>
                                        <input type="number" id="dlogParamP" value="47" placeholder="p">
                                    </div>
                                </div>
                                <small style="color: #888; display: block; margin-top: 6px;">
                                    Curve equation: y² ≡ x³ + ax + b (mod p)
                                </small>
                            </div>

                            <button onclick="initDiscreteLogDemo()" style="width: 100%; padding: 14px; font-size: 1em; font-weight: 600; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); border: none; border-radius: 8px; color: white; cursor: pointer; transition: all 0.2s;">
                                <i class="fa-solid fa-play" style="margin-right: 8px;"></i>Start: Initialize Curve
                            </button>

                            <div id="dlogCurveInfo" style="margin-top: 15px;"></div>
                        </div>

                        <!-- Step 2: Compute Public Key -->
                        <div id="dlogStep2Panel" style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.15) 0%, rgba(16, 185, 129, 0.08) 100%);
                            padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 3px solid rgba(16, 185, 129, 0.5); box-shadow: 0 2px 12px rgba(16, 185, 129, 0.12); opacity: 0.6;">

                            <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                <div style="width: 36px; height: 36px; background: #10b981; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 12px; font-weight: bold; font-size: 1.2em; color: white; box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);">②</div>
                                <div>
                                    <h3 style="margin: 0; color: #059669; font-size: 1.1em; font-weight: 700;">Compute Public Key</h3>
                                    <p style="margin: 2px 0 0 0; color: var(--text-secondary); font-size: 0.9em;">Pick a secret k and compute Q = k × G</p>
                                </div>
                            </div>

                            <div style="background: rgba(16, 185, 129, 0.15); padding: 12px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #10b981;">
                                <p style="margin: 0; color: var(--text-primary); font-size: 0.9em; line-height: 1.5;">
                                    <strong>🔑 What's happening:</strong> In real crypto, k is your private key (kept secret) and Q is your public key (shared with others). Computing Q from k is easy and fast.
                                </p>
                            </div>

                            <div class="form-group">
                                <label for="dlogScalar" style="font-weight: 500;">
                                    Choose Your Private Key k
                                    <span id="dlogKRange" style="color: #10b981; font-weight: 600;"></span>
                                </label>
                                <input type="number" id="dlogScalar" value="5" min="1" placeholder="Enter k" style="font-size: 1em; padding: 10px;">
                                <small style="display:block; margin-top:6px; color: var(--text-muted);">
                                    💡 Tip: Start with small values (5-20) to see the brute-force clearly!
                                </small>
                            </div>

                            <button onclick="computeDiscreteLogPublicKey()" id="dlogComputeBtn" disabled
                                style="width: 100%; padding: 14px; font-size: 1em; font-weight: 600; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border: none; border-radius: 8px; color: white; cursor: pointer; transition: all 0.2s;">
                                <i class="fa-solid fa-calculator" style="margin-right: 8px;"></i>Compute Public Key Q = k × G
                            </button>

                            <div id="dlogPublicKeyResult" style="margin-top: 15px;"></div>
                        </div>

                        <!-- Step 3: Brute Force Attack -->
                        <div id="dlogStep3Panel" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(239, 68, 68, 0.08) 100%);
                            padding: 20px; border-radius: 12px; border: 3px solid rgba(239, 68, 68, 0.5); box-shadow: 0 2px 12px rgba(239, 68, 68, 0.12); opacity: 0.6;">

                            <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                <div style="width: 36px; height: 36px; background: #ef4444; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 12px; font-weight: bold; font-size: 1.2em; color: white; box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);">③</div>
                                <div>
                                    <h3 style="margin: 0; color: #dc2626; font-size: 1.1em; font-weight: 700;">Attack: Find the Private Key</h3>
                                    <p style="margin: 2px 0 0 0; color: var(--text-secondary); font-size: 0.9em;">Try to recover k by testing all possibilities</p>
                                </div>
                            </div>

                            <div style="background: rgba(239, 68, 68, 0.15); padding: 12px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #ef4444;">
                                <p style="margin: 0; color: var(--text-primary); font-size: 0.9em; line-height: 1.5;">
                                    <strong>⚠️ The Challenge:</strong> Given only G and Q, an attacker must try k' = 1, 2, 3... until they find k' where k'×G = Q. This is the hard problem that makes ECC secure!
                                </p>
                            </div>

                            <div class="form-group">
                                <label class="checkbox-inline" style="display: flex; align-items: center; font-weight: 500; cursor: pointer;">
                                    <input type="checkbox" id="dlogUseBsgs" checked style="margin-right: 8px;">
                                    <span>Enable Smart Algorithm (Baby-step Giant-step)</span>
                                </label>
                                <small style="display:block; margin-top:6px; margin-left: 24px; color: var(--text-muted);">
                                    BSGS reduces complexity from O(n) to O(√n), but still shows key attempts. Automatically used for k &gt; 100.
                                </small>
                            </div>

                            <button onclick="bruteForceDiscreteLog()" id="dlogBruteforceBtn" disabled
                                style="width: 100%; padding: 14px; font-size: 1em; font-weight: 600; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); border: none; border-radius: 8px; color: white; cursor: pointer; transition: all 0.2s;">
                                <i class="fa-solid fa-bolt" style="margin-right: 8px;"></i>Launch Attack: Brute Force Discrete Log!
                            </button>

                            <div id="dlogBruteforceResult" style="margin-top: 15px;"></div>
                        </div>

                    </div>

                    <div class="panel">
                        <div class="dlog-attack-header">
                            <div class="dlog-attack-icon">
                                <i class="fa-solid fa-shield-halved"></i>
                            </div>
                            <div>
                                <h2 style="margin: 0 0 8px 0; display: flex; align-items: center; gap: 10px;">
                                    <i class="fa-solid fa-list-check" style="color: #ef4444;"></i>
                                    Attack Progress
                                </h2>
                                <p style="margin: 0; color: var(--text-secondary); line-height: 1.6;">
                                    Watch the algorithm test each value of k' in real-time as it tries to crack the key
                                </p>
                            </div>
                        </div>

                        <div id="dlogStepsContainer" class="dlog-steps-container">
                            <div class="dlog-empty-state">
                                <div class="dlog-empty-icon">
                                    <i class="fa-solid fa-magnifying-glass"></i>
                                </div>
                                <div class="dlog-empty-text">
                                    <p class="dlog-empty-title">No Attack in Progress</p>
                                    <p class="dlog-empty-subtitle">Complete Steps 1 & 2, then launch the brute-force attack to see attempts here.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Encryption Tab -->
            <div id="encryptionTab" class="tab-pane">
                <div id="encryptInitPane" class="subtab-pane active">
                    <div class="panel">
                        <h2>Setup Encryption</h2>
                        <div class="form-group">
                            <label for="encryptionPreset">Preset Curves</label>
                            <select id="encryptionPreset" onchange="loadEncryptionPreset(this.value)">
                                <option value="custom">Custom</option>
                                <option value="e23">E₂₃(1,1) - Tiny example</option>
                                <option value="e31">E₃₁(2,3) - Small example</option>
                                <option value="e47" selected>E₄₇(5,7) - Medium example</option>
                                <option value="e97">E₉₇(2,3) - Larger example</option>
                            </select>
                            <small id="encryptionCurveDesc" class="curve-description"></small>
                        </div>
                        <div class="form-group">
                            <div class="inline-inputs">
                                <div>
                                    <label for="encryptParamA">a</label>
                                    <input type="number" id="encryptParamA" value="5" placeholder="a">
                                </div>
                                <div>
                                    <label for="encryptParamB">b</label>
                                    <input type="number" id="encryptParamB" value="7" placeholder="b">
                                </div>
                                <div>
                                    <label for="encryptParamP">p (prime)</label>
                                    <input type="number" id="encryptParamP" value="47" placeholder="p">
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="encryptionPrivateKey">Custom Private Key (optional)</label>
                            <input type="number" id="encryptionPrivateKey" placeholder="Leave blank to auto-generate" min="1">
                            <small style="color:#aaa;">Use a value between 1 and p-1. Leave empty to generate a random key.</small>
                        </div>
                        <button onclick="initEncryptionCurve()">Initialize Encryption System</button>
                        <div id="encryptionSystemInfo"></div>

                        <div style="margin-top: 20px;">
                            <h3 style="color: #888; margin-bottom: 10px;">Operations</h3>
                            <button onclick="selectEncryptionPane('encryptPane')" style="margin-bottom: 10px; width: 100%;" id="encryptOperationBtn" disabled>Encrypt Message</button>
                            <button onclick="selectEncryptionPane('decryptPane')" style="width: 100%;" id="decryptOperationBtn" disabled>Decrypt Message</button>
                        </div>
                    </div>
                    <div class="panel">
                        <h2>Key Information</h2>
                        <div id="encryptionKeyInfo"></div>
                    </div>
                </div>

                <div id="encryptPane" class="subtab-pane">
                    <div class="panel">
                        <button onclick="selectEncryptionPane('encryptInitPane')" style="margin-bottom: 15px;">← Back to Setup</button>

                        <div class="encrypt-header">
                            <div class="encrypt-icon-wrapper">
                                <i class="fa-solid fa-lock"></i>
                            </div>
                            <div>
                                <h2 style="margin: 0 0 8px 0;">Encrypt Message</h2>
                                <p style="margin: 0; color: var(--text-secondary); line-height: 1.5;">
                                    Secure your messages using elliptic curve cryptography
                                </p>
                            </div>
                        </div>

                        <div class="encrypt-info-box">
                            <i class="fa-solid fa-circle-info"></i>
                            <div>
                                <strong>Choose your input method:</strong> Type a message, paste text, or upload any file type to encrypt.
                            </div>
                        </div>

                        <!-- Input Method Tabs -->
                        <div class="input-method-tabs">
                            <button class="input-tab active" onclick="switchEncryptInputMethod('text')" id="encryptTextTab">
                                <i class="fa-solid fa-keyboard"></i>
                                <span>Text Message</span>
                            </button>
                            <button class="input-tab" onclick="switchEncryptInputMethod('file')" id="encryptFileTab">
                                <i class="fa-solid fa-file-arrow-up"></i>
                                <span>Upload File</span>
                            </button>
                        </div>

                        <!-- Text Input Section -->
                        <div id="encryptTextInput" class="input-section active">
                            <div class="form-group">
                                <label for="plaintextInput">
                                    <i class="fa-solid fa-message" style="margin-right: 6px; color: var(--accent-primary);"></i>
                                    Your Message
                                </label>
                                <textarea id="plaintextInput" rows="5" placeholder="Type or paste your secret message here...&#10;&#10;Examples:&#10;• Personal notes&#10;• Passwords&#10;• API keys&#10;• Any confidential text" oninput="updateCharCount()"></textarea>
                                <div class="char-count-container">
                                    <span id="charCount" class="char-count">0 characters</span>
                                    <span class="char-hint">Will be encrypted with ECC</span>
                                </div>
                            </div>
                        </div>

                        <!-- File Input Section -->
                        <div id="encryptFileInput" class="input-section">
                            <div class="form-group">
                                <label>
                                    <i class="fa-solid fa-cloud-arrow-up" style="margin-right: 6px; color: var(--accent-primary);"></i>
                                    Upload File
                                </label>
                                <div class="file-upload-area" onclick="document.getElementById('encryptionFileInput').click()">
                                    <i class="fa-solid fa-file-arrow-up file-upload-icon"></i>
                                    <p class="file-upload-text">Click to browse or drag & drop</p>
                                    <p class="file-upload-hint">Any file type • Max size recommended: 10MB</p>
                                    <input type="file" id="encryptionFileInput" style="display: none;" onchange="updateFileInfo(this, 'encryptFileInfo')">
                                </div>
                                <div id="encryptFileInfo" class="file-info"></div>
                            </div>
                        </div>

                        <!-- Output Format Selection -->
                        <div class="form-group">
                            <label for="encryptionOutputFormat">
                                <i class="fa-solid fa-gear" style="margin-right: 6px; color: var(--accent-primary);"></i>
                                Output Format
                            </label>
                            <div class="format-selector">
                                <div class="format-option" onclick="selectFormat('json')">
                                    <input type="radio" name="outputFormat" id="formatJson" value="json" checked>
                                    <label for="formatJson">
                                        <i class="fa-solid fa-code"></i>
                                        <div>
                                            <strong>JSON Format</strong>
                                            <span>Full details with structure</span>
                                        </div>
                                    </label>
                                </div>
                                <div class="format-option" onclick="selectFormat('ciphertext')">
                                    <input type="radio" name="outputFormat" id="formatCiphertext" value="ciphertext">
                                    <label for="formatCiphertext">
                                        <i class="fa-solid fa-compress"></i>
                                        <div>
                                            <strong>Compact Ciphertext</strong>
                                            <span>Base64 encoded, easy to share</span>
                                        </div>
                                    </label>
                                </div>
                            </div>
                            <select id="encryptionOutputFormat" style="display: none;">
                                <option value="json">JSON (Full Details)</option>
                                <option value="ciphertext">Ciphertext Only (Compact)</option>
                            </select>
                        </div>

                        <button onclick="encryptMessage()" class="encrypt-btn">
                            <i class="fa-solid fa-lock"></i>
                            Encrypt Now
                        </button>

                        <div id="encryptionResult"></div>
                        <div id="encryptionStepsDisplay" class="steps-display"></div>
                    </div>
                    <div class="panel">
                        <h2>Encryption Visualization</h2>
                        <p style="margin-bottom: 15px; color: #888;">Watch the encryption process step by step</p>
                        <canvas id="encryptionCanvas" width="600" height="500"></canvas>
                        <div class="steps-toggle-row">
                            <button id="encryptionToggleStepsBtn" class="toggle-steps-btn" type="button" onclick="toggleStepsDisplay('encryption')" data-visible="true">
                                Hide steps
                            </button>
                        </div>
                    </div>
                </div>

                <div id="decryptPane" class="subtab-pane">
                    <div class="panel">
                        <button onclick="selectEncryptionPane('encryptInitPane')" style="margin-bottom: 15px;">← Back to Setup</button>

                        <div class="decrypt-header">
                            <div class="decrypt-icon-wrapper">
                                <i class="fa-solid fa-lock-open"></i>
                            </div>
                            <div>
                                <h2 style="margin: 0 0 8px 0;">Decrypt Message</h2>
                                <p style="margin: 0; color: var(--text-secondary); line-height: 1.5;">
                                    Reveal encrypted messages using your private key
                                </p>
                            </div>
                        </div>

                        <div class="decrypt-info-box">
                            <i class="fa-solid fa-shield-halved"></i>
                            <div>
                                <strong>Auto-format detection:</strong> Paste JSON or compact ciphertext. The system will automatically detect and decode your format.
                            </div>
                        </div>

                        <!-- Input Method Tabs -->
                        <div class="input-method-tabs">
                            <button class="input-tab active" onclick="switchDecryptInputMethod('paste')" id="decryptPasteTab">
                                <i class="fa-solid fa-paste"></i>
                                <span>Paste Ciphertext</span>
                            </button>
                            <button class="input-tab" onclick="switchDecryptInputMethod('file')" id="decryptFileTab">
                                <i class="fa-solid fa-file-import"></i>
                                <span>Upload File</span>
                            </button>
                        </div>

                        <!-- Paste Input Section -->
                        <div id="decryptPasteInput" class="input-section active">
                            <div class="form-group">
                                <label for="ciphertextInput">
                                    <i class="fa-solid fa-file-code" style="margin-right: 6px; color: var(--accent-primary);"></i>
                                    Ciphertext or JSON
                                </label>
                                <textarea id="ciphertextInput" rows="2" placeholder='Paste JSON or Base64 ciphertext here (auto-detects format)...' oninput="updateCiphertextInfo()"></textarea>
                                <div class="ciphertext-info-bar">
                                    <span id="ciphertextFormat" class="format-badge">
                                        <i class="fa-solid fa-circle-question"></i>
                                        Waiting for input
                                    </span>
                                    <span id="ciphertextLength" class="length-badge">0 chars</span>
                                </div>
                            </div>

                            <div class="quick-actions">
                                <button type="button" onclick="clearCiphertext()" class="action-btn secondary">
                                    <i class="fa-solid fa-xmark"></i>
                                    Clear
                                </button>
                                <button type="button" onclick="pasteSampleCiphertext()" class="action-btn">
                                    <i class="fa-solid fa-flask"></i>
                                    Try Sample
                                </button>
                            </div>
                        </div>

                        <!-- File Input Section -->
                        <div id="decryptFileInput" class="input-section">
                            <div class="form-group">
                                <label>
                                    <i class="fa-solid fa-file-import" style="margin-right: 6px; color: var(--accent-primary);"></i>
                                    Upload Encrypted File
                                </label>
                                <div class="file-upload-area" onclick="document.getElementById('decryptionFileInput').click()">
                                    <i class="fa-solid fa-file-import file-upload-icon"></i>
                                    <p class="file-upload-text">Click to browse or drag & drop</p>
                                    <p class="file-upload-hint">Supports JSON and ciphertext files</p>
                                    <input type="file" id="decryptionFileInput" style="display: none;" onchange="updateFileInfo(this, 'decryptFileInfo')">
                                </div>
                                <div id="decryptFileInfo" class="file-info"></div>
                            </div>
                        </div>

                        <button onclick="decryptMessage()" class="decrypt-btn">
                            <i class="fa-solid fa-unlock"></i>
                            Decrypt Now
                        </button>

                        <div id="decryptionResult"></div>
                        <div id="decryptionStepsDisplay" class="steps-display"></div>
                    </div>
                    <div class="panel">
                        <h2>Decryption Visualization</h2>
                        <p style="margin-bottom: 15px; color: #888;">Watch the decryption process step by step</p>
                        <canvas id="decryptionCanvas" width="600" height="500"></canvas>
                        <div class="steps-toggle-row">
                            <button id="decryptionToggleStepsBtn" class="toggle-steps-btn" type="button" onclick="toggleStepsDisplay('decryption')" data-visible="true">
                                Hide steps
                            </button>
                        </div>
                    </div>
                </div>

        </div>
    </div>

    <!-- Floating ECC Expert Chat -->
    <div class="chat-assistant" aria-live="polite">
        <button id="chatToggleBtn" class="chat-fab" aria-label="Open ECC expert chat">
            <i class="fa-solid fa-robot"></i>
        </button>
        <div id="chatWindow" class="chat-window">
            <div class="chat-header">
                <div>
                    <div class="chat-title">ECC Expert</div>
                    <div class="chat-subtitle">Ask about curves, keys, or crypto flow</div>
                </div>
                <div class="chat-header-actions">
                    <span id="chatStatus" class="chat-status">Ready</span>
                    <button id="chatCloseBtn" class="chat-close-btn" aria-label="Close chat">×</button>
                </div>
            </div>
            <div id="chatMessages" class="chat-messages">
                <div class="chat-message bot">
                    <div class="chat-avatar"><i class="fa-solid fa-wave-square" aria-hidden="true"></i></div>
                    <div class="chat-bubble">
                        Hi! I’m your elliptic-curve guide. Ask me how to pick base points, verify group laws, or troubleshoot key exchange.
                    </div>
                </div>
            </div>
            <form id="chatForm" class="chat-input-area">
                <textarea id="chatInput" rows="2" placeholder="Ask how to choose p, find generators, or compute kP fast..." required></textarea>
                <button type="submit" class="chat-send-btn">
                    <span class="send-label">Send</span>
                    <i class="fa-solid fa-paper-plane" aria-hidden="true"></i>
                </button>
            </form>
        </div>
    </div>

            <script src="{{ url_for('static', filename='js/calculator.js') }}"></script>

</html>
