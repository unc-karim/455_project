<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elliptic Curve</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/calculator.css') }}">
</head>
<body>
    <!-- Toast Notification Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <div class="loading-text">Calculating...</div>
            <div class="loading-details"></div>
        </div>
    </div>

    <!-- History Panel Overlay -->
    <div id="historyOverlay" class="history-overlay" onclick="closeHistoryPanel()"></div>

    <!-- Sliding History Panel -->
    <div id="historyPanel" class="history-panel">
        <div class="history-panel-header">
            <h2><i class="fa-solid fa-gear panel-title-icon" aria-hidden="true"></i> Menu</h2>
            <button class="history-close-btn" onclick="closeHistoryPanel()" aria-label="Close menu panel">×</button>
        </div>
        <div class="history-panel-content">

            <!-- User Profile Section -->
            <div class="menu-section">
                <div class="menu-section-header">
                        <div class="user-profile-card">
                            <div class="user-avatar"><i class="fa-solid fa-circle-user" aria-hidden="true"></i></div>
                        <div class="user-info">
                            <div class="user-name" id="menuUserName">Guest</div>
                            <div class="user-status" id="menuUserStatus">Not signed in</div>
                        </div>
                    </div>
                    <button id="menuAuthBtn" class="btn-auth" onclick="openLoginModal()">Sign In</button>
                </div>
            </div>

            <!-- Quick Actions Section -->
            <div class="menu-section">
                <h3 class="menu-section-title">Quick Actions</h3>
                    <div class="menu-grid">
                        <button class="menu-card" onclick="toggleTheme()" title="Toggle light/dark theme">
                            <span class="menu-card-icon theme-icon"><i class="fa-solid fa-moon" aria-hidden="true"></i></span>
                        <span class="menu-card-label">Theme</span>
                        <span class="menu-card-hint">Toggle mode</span>
                    </button>
                        <button class="menu-card" onclick="showKeyboardHelp()" title="View keyboard shortcuts">
                            <span class="menu-card-icon"><i class="fa-solid fa-keyboard" aria-hidden="true"></i></span>
                        <span class="menu-card-label">Shortcuts</span>
                        <span class="menu-card-hint">View all</span>
                    </button>
                        <button class="menu-card" onclick="showFormulaReference()" title="Mathematical formulas">
                            <span class="menu-card-icon"><i class="fa-solid fa-ruler-combined" aria-hidden="true"></i></span>
                        <span class="menu-card-label">Formulas</span>
                        <span class="menu-card-hint">Reference</span>
                    </button>
                        <button class="menu-card" onclick="exportUnifiedHistory()" title="Export history">
                            <span class="menu-card-icon"><i class="fa-solid fa-file-export" aria-hidden="true"></i></span>
                        <span class="menu-card-label">Export</span>
                        <span class="menu-card-hint">Save data</span>
                    </button>
                </div>
            </div>

            <!-- History Section -->
            <div class="menu-section">
                <div class="menu-section-title-row">
                        <h3 class="menu-section-title"><i class="fa-solid fa-scroll menu-title-icon" aria-hidden="true"></i> History</h3>
                        <div class="menu-section-actions">
                            <button class="icon-btn" onclick="refreshUnifiedHistory()" title="Refresh history">
                                <span aria-hidden="true"><i class="fa-solid fa-arrows-rotate"></i></span>
                            </button>
                            <button class="icon-btn" onclick="clearUnifiedHistory()" title="Clear history">
                                <span aria-hidden="true"><i class="fa-solid fa-trash-can"></i></span>
                            </button>
                        </div>
                    </div>
                <div id="unifiedHistoryList" class="history-list"></div>
            </div>

        </div>
    </div>

    <div class="container">
        <div class="header">
            <button class="info-btn" onclick="toggleAboutModal()" title="About & Help" aria-label="About and help">
                <span class="info-icon"><i class="fa-solid fa-circle-info" aria-hidden="true"></i></span>
            </button>
            <h1>Elliptic Curve</h1>
            <div class="header-buttons">
                <button class="history-toggle" onclick="toggleHistoryPanel()" title="Menu" aria-label="Open menu panel">
                    <div class="hamburger-line"></div>
                    <div class="hamburger-line"></div>
                    <div class="hamburger-line"></div>
                </button>
            </div>
        </div>

        <!-- Auth Overlay -->
        <div id="authOverlay" class="auth-overlay">
            <div class="auth-card">
                <div style="text-align:center;">
                    <div class="auth-icon" aria-hidden="true"><i class="fa-solid fa-lock" aria-hidden="true"></i></div>
                    <div class="auth-title">Sign in</div>
                    <div class="auth-sub">Access your elliptic curve workspace.</div>
                </div>
                <div class="auth-form">
                    <div class="auth-field">
                        <svg class="auth-ico" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 12c2.7 0 5-2.3 5-5s-2.3-5-5-5-5 2.3-5 5 2.3 5 5 5zm0 2c-3.3 0-10 1.7-10 5v3h20v-3c0-3.3-6.7-5-10-5z"/></svg>
                        <input id="loginUsername" type="text" placeholder="Username">
                        <div id="loginUsernameErr" class="field-error" style="display:none;"></div>
                    </div>
                    <div class="auth-field">
                        <svg class="auth-ico" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 17a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm6-6V9a6 6 0 1 0-12 0v2H4v10h16V11h-2zm-8-2a4 4 0 1 1 8 0v2H10V9z"/></svg>
                        <input id="loginPassword" type="password" placeholder="Password">
                        <div id="loginPasswordErr" class="field-error" style="display:none;"></div>
                    </div>
                    <div class="auth-right-row">
                        <a class="auth-right-link" href="#" onclick="alert('Reset link flow not implemented')">Forgot password?</a>
                    </div>
                    <button class="btn-primary-dark" onclick="submitLoginCard()">Get Started</button>
                    <div class="auth-sep"><div class="line"></div><div class="txt">Or</div><div class="line"></div></div>
                    <div class="btn-row">
                        <button class="btn-pill secondary" onclick="openSignupPage()">Create an account</button>
                        <button class="btn-pill ghost" onclick="continueAsGuestCard()">Continue as guest</button>
                    </div>
                    <div id="authMsgOverlay" class="auth-msg" aria-live="polite"></div>
                </div>
            </div>
        </div>
        
        <div class="content">

            <!-- Curve Type Selector and Encryption Selector -->
            <div style="text-align: center; margin: 20px 0; display: flex; gap: 20px; justify-content: center; align-items: center;">
                <div class="curve-selector-dropdown">
                    <button class="curve-selector-btn" id="curveSelectorBtn">
                        <span>Curve type</span>
                        <span class="dropdown-arrow">▼</span>
                    </button>
                    <div class="curve-dropdown-menu">
                        <div class="curve-dropdown-item active" onclick="selectCurveType('fpTab', 'Curve over Fp')">Curve over Fp</div>
                        <div class="curve-dropdown-item" onclick="selectCurveType('realTab', 'Curve over ℝ')">Curve over ℝ</div>
                    </div>
                </div>

                <div class="curve-selector-dropdown">
                    <button class="curve-selector-btn" id="encryptionSelectorBtn">
                        <span>Encryption/Decryption</span>
                        <span class="dropdown-arrow">▼</span>
                    </button>
                    <div class="curve-dropdown-menu">
                        <div class="curve-dropdown-item active" onclick="selectEncryptionPane('encryptInitPane', event)">Initialization</div>
                    </div>
                </div>
            </div>

            <!-- About Modal -->
            <div id="aboutModal" class="about-modal">
                <div class="about-modal-overlay" onclick="closeAboutModal()"></div>
                <div class="about-modal-content">
                    <button class="about-modal-close" onclick="closeAboutModal()" aria-label="Close about">×</button>
                    <div class="about-modal-body">
                <div class="panel full-width">
                    <h2>About</h2>
                    <p style="margin-bottom: 12px; color:#ccc;">
                        This app lets you explore elliptic curves over finite fields. You can generate all points on a curve,
                        add two points using the group law, and follow scalar multiplication step by step with a clear, discrete visualization.
                    </p>

                    <div class="math-formula">y² = x³ + ax + b (mod p)</div>

                    <p style="margin: 12px 0; color:#ccc;">
                        Here, <strong>p</strong> is a prime modulus, and <strong>a</strong>, <strong>b</strong> are integers. All arithmetic (additions,
                        subtractions, multiplications, divisions) is performed modulo <strong>p</strong>. The set of points that satisfy the equation,
                        plus a special identity element <strong>O</strong> (the “point at infinity”), forms an abelian group under a well‑defined addition rule.
                    </p>

                    <h3 style="color:#000000; margin-top:16px;">Key Concepts</h3>
                    <ul style="margin-left: 20px; line-height: 1.8; color:#ccc;">
                        <li><strong>Valid curve:</strong> The discriminant <code>Δ = 4a³ + 27b² (mod p)</code> must be non‑zero to avoid singularities.</li>
                        <li><strong>Point at infinity (O):</strong> Acts as the identity element: <code>P + O = P</code>.</li>
                        <li><strong>Negation:</strong> For a point <code>P = (x, y)</code>, its inverse is <code>-P = (x, -y mod p)</code>.</li>
                        <li><strong>Point addition:</strong> The line through <code>P</code> and <code>Q</code> intersects the curve at a third point; reflect it across the x‑axis to get <code>P + Q</code>. In finite fields, the “line” is an algebraic relation handled with modular arithmetic.</li>
                        <li><strong>Point doubling:</strong> When <code>P = Q</code>, use the tangent at <code>P</code> to compute <code>2P</code>.</li>
                        <li><strong>Scalar multiplication:</strong> Repeated addition, efficiently computed via the double‑and‑add method.</li>
                    </ul>

                    <h3 style="color:#000000; margin-top:16px;">How to Use This App</h3>
                    <ul style="margin-left: 20px; line-height: 1.8; color:#ccc;">
                        <li><strong>Initialization:</strong> Pick <code>a</code>, <code>b</code>, and a prime <code>p</code>, then click “Find All Points on Curve”. The list below shows every point (including <code>O</code>).</li>
                        <li><strong>Visualization:</strong> The canvases plot all points with axes from <code>0</code> to <code>p−1</code> on both x and y. Use the “Show point labels” toggle to annotate points.</li>
                        <li><strong>Point Addition:</strong> Choose <code>P</code> and <code>Q</code> to compute <code>P + Q</code>. The result is highlighted on the plot.</li>
                        <li><strong>Scalar Multiplication:</strong> Choose a point <code>P</code> and scalar <code>k</code>. Step through each intermediate multiple with the controls and slider.</li>
                    </ul>

                    <h3 style="color:#000000; margin-top:16px;">Tips and Notes</h3>
                    <ul style="margin-left: 20px; line-height: 1.8; color:#ccc;">
                        <li>Choose moderate primes (for example, <code>p ≈ 50–200</code>) to keep the plots readable while still showing structure.</li>
                        <li>If <code>Δ = 0</code> for your parameters, pick a different <code>a</code> and <code>b</code> so the curve is non‑singular.</li>
                        <li>The “Show point labels” option is off by default to reduce clutter. Turn it on when you need exact coordinates.</li>
                        <li>All points are plotted in a grid of integers; there are no fractional coordinates in this finite‑field setting.</li>
                    </ul>

                    <h3 style="color:#000000; margin-top:16px;">Why Elliptic Curves?</h3>
                    <p style="margin: 8px 0; color:#ccc;">
                        Elliptic‑curve groups enable compact, efficient public‑key operations such as key exchange and digital signatures.
                        Over finite fields, their algebraic structure provides strong security per bit of key size and underpins many modern protocols.
                    </p>
                </div>
                    </div>
                </div>
            </div>

            <!-- Real Curve (ℝ) Tab -->
            <div id="realTab" class="tab-pane">

                <div id="realInitPane" class="subtab-pane active">
                    <div class="panel">
                        <h2>Define Curve</h2>
                        <div class="form-group">
                            <div class="inline-inputs">
                                <div>
                                    <label for="realParamA">a</label>
                                    <input type="number" step="any" id="realParamA" value="-1" placeholder="a">
                                </div>
                                <div>
                                    <label for="realParamB">b</label>
                                    <input type="number" step="any" id="realParamB" value="1" placeholder="b">
                                </div>
                            </div>
                        </div>
                        <button onclick="initRealCurve()">Initialize Curve</button>

                        <div style="margin-top: 20px;">
                            <h3 style="color: #888; margin-bottom: 10px;">Operations</h3>
                            <button onclick="switchSubtab('real','realAddPane')" style="margin-bottom: 10px; width: 100%;">Point Addition</button>
                            <button onclick="switchSubtab('real','realMulPane')" style="width: 100%;">Scalar Multiplication</button>
                        </div>
                    </div>
                    <div class="panel">
                        <h2>Visualization</h2>
                        <p style="margin-bottom: 15px; color: #888;">Smooth curve plot over real numbers</p>
                        <canvas id="realCurveCanvas" width="600" height="500"></canvas>
                        <label style="display:block; margin-top:8px; color:#aaa; font-size:0.95em;">
                            <input id="realShowLabels" type="checkbox" checked onchange="redrawRealCanvases()"> Show point labels
                        </label>
                    </div>
                </div>

                <div id="realAddPane" class="subtab-pane">
                    <div class="panel">
                        <button onclick="switchSubtab('real','realInitPane')" style="margin-bottom: 15px;">← Back to Initialization</button>
                        <h2>Point Addition (ℝ)</h2>
                        <p style="margin-bottom: 15px; color: #888;">Geometric chord/tangent visualization</p>
                        <div class="form-group">
                            <div class="inline-inputs">
                                <div>
                                    <label for="realP1X">P.x</label>
                                    <input type="number" step="any" id="realP1X" placeholder="x₁">
                                </div>
                                <div>
                                    <label for="realP1Y">P.y</label>
                                    <input type="number" step="any" id="realP1Y" placeholder="y₁">
                                </div>
                                <div>
                                    <label for="realSelectMode">Pick Mode</label>
                                    <select id="realSelectMode">
                                        <option value="P">Select P</option>
                                        <option value="Q">Select Q</option>
                                    </select>
                                </div>
                            </div>
                            <div class="point-status" id="realPoint1Status">Enter both coordinates</div>
                        </div>
                        <div class="form-group">
                            <div class="inline-inputs">
                                <div>
                                    <label for="realP2X">Q.x</label>
                                    <input type="number" step="any" id="realP2X" placeholder="x₂">
                                </div>
                                <div>
                                    <label for="realP2Y">Q.y</label>
                                    <input type="number" step="any" id="realP2Y" placeholder="y₂">
                                </div>
                                <div>
                                    <label>&nbsp;</label>
                                    <button onclick="addPointsReal()">Calculate P + Q</button>
                                </div>
                            </div>
                            <div class="point-status" id="realPoint2Status">Enter both coordinates</div>
                        </div>
                        <div id="realAdditionResult"></div>
                    </div>
                    <div class="panel">
                        <h2>Visualization</h2>
                        <p style="margin-bottom: 15px; color: #888;">Click on the curve to set P or Q</p>
                        <canvas id="realAdditionCanvas" width="600" height="500"></canvas>
                        <label style="display:block; margin-top:8px; color:#aaa; font-size:0.95em;">
                            <input id="realAdditionShowLabels" type="checkbox" checked onchange="drawRealAdditionScene()"> Show point labels
                        </label>
                        <div class="steps-toggle-row">
                            <button id="realAdditionToggleStepsBtn" class="toggle-steps-btn" type="button" onclick="toggleStepsDisplay('realAddition')" data-visible="true">
                                Hide steps
                            </button>
                        </div>
                    </div>
                </div>

                <div id="realMulPane" class="subtab-pane">
                    <div class="panel">
                        <button onclick="switchSubtab('real','realInitPane')" style="margin-bottom: 15px;">← Back to Initialization</button>
                        <h2>Scalar Multiplication (ℝ)</h2>
                        <p style="margin-bottom: 15px; color: #888;">Follow k × P along the curve</p>
                        <div class="form-group">
                            <div class="inline-inputs">
                                <div>
                                    <label for="realK">k</label>
                                    <input type="number" id="realK" value="3" placeholder="k">
                                </div>
                                <div>
                                    <label for="realMulPX">P.x</label>
                                    <input type="number" step="any" id="realMulPX" placeholder="x">
                                </div>
                                <div>
                                    <label for="realMulPY">P.y</label>
                                    <input type="number" step="any" id="realMulPY" placeholder="y">
                                </div>
                            </div>
                            <div class="point-status" id="realScalarPointStatus">Enter both coordinates</div>
                        </div>
                        <button onclick="scalarMultiplyReal()">Calculate k × P</button>
                        <div id="realScalarResult"></div>
                    </div>
                    <div class="panel">
                        <h2>Visualization</h2>
                        <p style="margin-bottom: 15px; color: #888;">Visualization</p>
                        <canvas id="realMultiplicationCanvas" width="600" height="500"></canvas>
                        <label style="display:block; margin-top:8px; color:#aaa; font-size:0.95em;">
                            <input id="realMultiplicationShowLabels" type="checkbox" checked onchange="renderRealScalarAll()"> Show point labels
                        </label>
                        <div class="steps-toggle-row">
                            <button id="realScalarToggleStepsBtn" class="toggle-steps-btn" type="button" onclick="toggleStepsDisplay('realScalar')" data-visible="true">
                                Hide steps
                            </button>
                        </div>
                        <div id="realAnimControls" class="anim-controls" style="display:none;"></div>
                    </div>
                </div>

            </div>

            <!-- Curve over Fp Tab -->
            <div id="fpTab" class="tab-pane active">

                <div id="fpInitPane" class="subtab-pane active">
                    <div class="panel">
                        <h2>Define Curve</h2>
                        <div class="form-group">
                            <label for="curvePreset">Preset Curves</label>
                            <select id="curvePreset" onchange="loadCurvePreset(this.value)">
                                <option value="custom">Custom</option>
                                <optgroup label="Famous Curves (Simplified)">
                                    <option value="secp256k1">secp256k1-like (Bitcoin)</option>
                                    <option value="p256">P-256-like (NIST)</option>
                                </optgroup>
                                <optgroup label="Small Examples">
                                    <option value="e23">E₂₃(1,1) - Tiny example</option>
                                    <option value="e31">E₃₁(2,3) - Small example</option>
                                    <option value="e47">E₄₇(5,7) - Medium example</option>
                                    <option value="e97" selected>E₉₇(2,3) - Default</option>
                                    <option value="e127">E₁₂₇(1,2) - Larger example</option>
                                </optgroup>
                            </select>
                            <small id="curveDescription" class="curve-description"></small>
                        </div>
                        <div class="form-group">
                            <div class="inline-inputs">
                                <div>
                                    <label for="paramA">a</label>
                                    <input type="number" id="paramA" value="2" placeholder="a">
                                </div>
                                <div>
                                    <label for="paramB">b</label>
                                    <input type="number" id="paramB" value="3" placeholder="b">
                                </div>
                                <div>
                                    <label for="paramP">p (prime)</label>
                                    <input type="number" id="paramP" value="97" placeholder="p">
                                </div>
                            </div>
                        </div>
                        <button onclick="findAllPoints()">Find All Points on Curve</button>

                        <div style="margin-top: 20px;">
                            <h3 style="color: #888; margin-bottom: 10px;">Operations</h3>
                            <button onclick="switchSubtab('fp','fpAddPane')" style="margin-bottom: 10px; width: 100%;">Point Addition</button>
                            <button onclick="switchSubtab('fp','fpMulPane')" style="width: 100%;">Scalar Multiplication</button>
                        </div>
                    </div>
                    <div class="panel">
                        <h2>Points</h2>
                        <div id="curveInfo"></div>
                        <div id="pointsList"></div>
                    </div>
                </div>

                <div id="fpAddPane" class="subtab-pane">
                    <div class="panel">
                        <button onclick="switchSubtab('fp','fpInitPane')" style="margin-bottom: 15px;">← Back to Initialization</button>
                        <h2>Point Addition</h2>
                        <p style="margin-bottom: 15px; color: #888;">Add two points: P + Q = R</p>
                        <div class="form-group">
                            <label for="point1Select">Point P</label>
                            <select id="point1Select"><option value="">Select Point P</option></select>
                        </div>
                        <div class="form-group">
                            <label for="point2Select">Point Q</label>
                            <select id="point2Select"><option value="">Select Point Q</option></select>
                        </div>
                        <button onclick="addPoints()">Calculate P + Q</button>
                        <div id="additionResult"></div>
                    </div>
                    <div class="panel">
                        <h2>Visualization</h2>
                        <p style="margin-bottom: 15px; color: #888;">Points on the elliptic curve (mod p)</p>
                        <canvas id="additionCanvas" width="600" height="500"></canvas>
                        <label style="display:block; margin-top:8px; color:#aaa; font-size:0.95em;">
                            <input id="additionShowLabels" type="checkbox" checked onchange="redrawAdditionCanvas()"> Show point labels
                        </label>
                        <div class="steps-toggle-row">
                            <button id="additionToggleStepsBtn" class="toggle-steps-btn" type="button" onclick="toggleStepsDisplay('addition')" data-visible="true">
                                Hide steps
                            </button>
                        </div>
                        <div id="additionPointInfo" class="point-info" aria-live="polite"></div>
                    </div>
                </div>

                <div id="fpMulPane" class="subtab-pane">
                    <div class="panel">
                        <button onclick="switchSubtab('fp','fpInitPane')" style="margin-bottom: 15px;">← Back to Initialization</button>
                        <h2>Scalar Multiplication</h2>
                        <p style="margin-bottom: 15px; color: #888;">Multiply a point by a scalar: k × P</p>
                        <div class="form-group">
                            <label for="scalarPointSelect">Point P</label>
                            <select id="scalarPointSelect"><option value="">Select Point P</option></select>
                        </div>
                        <div class="form-group">
                            <label for="scalarValue">Scalar k</label>
                            <input type="number" id="scalarValue" value="3" placeholder="k">
                        </div>
                        <button onclick="scalarMultiply()">Calculate k × P</button>
                        <div id="scalarResult"></div>
                    </div>
                    <div class="panel">
                        <h2>Visualization</h2>
                        <p style="margin-bottom: 15px; color: #888;">Visualization</p>
                        <canvas id="multiplicationCanvas" width="600" height="500"></canvas>
                        <label style="display:block; margin-top:8px; color:#aaa; font-size:0.95em;">
                            <input id="multiplicationShowLabels" type="checkbox" checked onchange="renderFpScalarAll()"> Show point labels
                        </label>
                        <div class="steps-toggle-row">
                            <button id="scalarToggleStepsBtn" class="toggle-steps-btn" type="button" onclick="toggleStepsDisplay('scalar')" data-visible="true">
                                Hide steps
                            </button>
                        </div>
                        <div id="multiplicationPointInfo" class="point-info" aria-live="polite"></div>
                        <div id="animationControls" class="anim-controls" style="display:none;">
                            <button id="prevStepBtn" onclick="prevScalarStep()" disabled>Prev</button>
                            <button id="playPauseBtn" onclick="toggleScalarAnimation()" disabled>Play</button>
                            <input id="stepSlider" type="range" min="0" max="0" value="0" disabled oninput="onScalarSlider(this.value)">
                            <button id="nextStepBtn" onclick="nextScalarStep()" disabled>Next</button>
                            <span id="stepLabel" class="step-label">0/0</span>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Encryption Tab -->
            <div id="encryptionTab" class="tab-pane">
                <div id="encryptInitPane" class="subtab-pane active">
                    <div class="panel">
                        <h2>Setup Encryption</h2>
                        <div class="form-group">
                            <label for="encryptionPreset">Preset Curves</label>
                            <select id="encryptionPreset" onchange="loadEncryptionPreset(this.value)">
                                <option value="custom">Custom</option>
                                <option value="e23">E₂₃(1,1) - Tiny example</option>
                                <option value="e31">E₃₁(2,3) - Small example</option>
                                <option value="e47" selected>E₄₇(5,7) - Medium example</option>
                                <option value="e97">E₉₇(2,3) - Larger example</option>
                            </select>
                            <small id="encryptionCurveDesc" class="curve-description"></small>
                        </div>
                        <div class="form-group">
                            <div class="inline-inputs">
                                <div>
                                    <label for="encryptParamA">a</label>
                                    <input type="number" id="encryptParamA" value="5" placeholder="a">
                                </div>
                                <div>
                                    <label for="encryptParamB">b</label>
                                    <input type="number" id="encryptParamB" value="7" placeholder="b">
                                </div>
                                <div>
                                    <label for="encryptParamP">p (prime)</label>
                                    <input type="number" id="encryptParamP" value="47" placeholder="p">
                                </div>
                            </div>
                        </div>
                        <button onclick="initEncryptionCurve()">Initialize Encryption System</button>
                        <div id="encryptionSystemInfo"></div>

                        <div style="margin-top: 20px;">
                            <h3 style="color: #888; margin-bottom: 10px;">Operations</h3>
                            <button onclick="selectEncryptionPane('encryptPane')" style="margin-bottom: 10px; width: 100%;" id="encryptOperationBtn" disabled>Encrypt Message</button>
                            <button onclick="selectEncryptionPane('decryptPane')" style="width: 100%;" id="decryptOperationBtn" disabled>Decrypt Message</button>
                        </div>
                    </div>
                    <div class="panel">
                        <h2>Key Information</h2>
                        <div id="encryptionKeyInfo"></div>
                    </div>
                </div>

                <div id="encryptPane" class="subtab-pane">
                    <div class="panel">
                        <button onclick="selectEncryptionPane('encryptInitPane')" style="margin-bottom: 15px;">← Back to Setup</button>
                        <h2>Encrypt Message</h2>
                        <p style="margin-bottom: 15px; color: #888;">Encrypt text using elliptic curve cryptography</p>
                        <div class="form-group">
                            <label for="plaintextInput">Message to Encrypt</label>
                            <textarea id="plaintextInput" rows="4" placeholder="Enter your message here..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="encryptionFileInput">Or upload a file</label>
                            <input type="file" id="encryptionFileInput">
                            <small style="color:#aaa;">File bytes will be encrypted instead of the text above.</small>
                        </div>
                        <button onclick="encryptMessage()">Encrypt</button>
                        <div id="encryptionResult"></div>
                        <div id="encryptionStepsDisplay" class="steps-display"></div>
                    </div>
                    <div class="panel">
                        <h2>Encryption Visualization</h2>
                        <p style="margin-bottom: 15px; color: #888;">Watch the encryption process step by step</p>
                        <canvas id="encryptionCanvas" width="600" height="500"></canvas>
                        <div class="steps-toggle-row">
                            <button id="encryptionToggleStepsBtn" class="toggle-steps-btn" type="button" onclick="toggleStepsDisplay('encryption')" data-visible="true">
                                Hide steps
                            </button>
                        </div>
                    </div>
                </div>

                <div id="decryptPane" class="subtab-pane">
                    <div class="panel">
                        <button onclick="selectEncryptionPane('encryptInitPane')" style="margin-bottom: 15px;">← Back to Setup</button>
                        <h2>Decrypt Message</h2>
                        <p style="margin-bottom: 15px; color: #888;">Decrypt ciphertext using your private key</p>
                        <div class="form-group">
                            <label for="ciphertextInput">Ciphertext (JSON format)</label>
                            <textarea id="ciphertextInput" rows="6" placeholder='{"R": {"x": ..., "y": ...}, "encrypted": [...], "iv": ...}'></textarea>
                        </div>
                        <div class="form-group">
                            <label for="decryptionFileInput">Or upload ciphertext file</label>
                            <input type="file" id="decryptionFileInput" accept=".json,application/json">
                            <small style="color:#aaa;">Only JSON ciphertext files are allowed.</small>
                        </div>
                        <button onclick="decryptMessage()">Decrypt</button>
                        <div id="decryptionResult"></div>
                        <div id="decryptionStepsDisplay" class="steps-display"></div>
                    </div>
                    <div class="panel">
                        <h2>Decryption Visualization</h2>
                        <p style="margin-bottom: 15px; color: #888;">Watch the decryption process step by step</p>
                        <canvas id="decryptionCanvas" width="600" height="500"></canvas>
                        <div class="steps-toggle-row">
                            <button id="decryptionToggleStepsBtn" class="toggle-steps-btn" type="button" onclick="toggleStepsDisplay('decryption')" data-visible="true">
                                Hide steps
                            </button>
                        </div>
                    </div>
                </div>

        </div>
    </div>

            <script src="{{ url_for('static', filename='js/calculator.js') }}"></script>

</html>
