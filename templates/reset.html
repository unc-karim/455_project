<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/signup.css') }}">
</head>
<body>
    <div class="bg">
        <div class="card">
            <div style="text-align:center;">
                <div class="icon" aria-hidden="true">ðŸ”‘</div>
                <div class="title">Reset your password</div>
                <div class="sub">Enter your new password below.</div>
            </div>

            <div class="form">
                <input type="hidden" id="resetToken" value="{{ token }}">
                <div class="field">
                    <input id="newPassword" type="password" placeholder="New password">
                    <div id="resetPwErr" class="err"></div>
                </div>
                <div class="field">
                    <input id="confirmPassword" type="password" placeholder="Confirm password">
                    <div id="resetConfirmErr" class="err"></div>
                </div>

                <button class="btn-primary-dark" onclick="submitReset()">Update password</button>
                <div id="resetMsg" class="msg" aria-live="polite"></div>
            </div>
        </div>
    </div>

    <script>
    function setErr(id,msg){ const el=document.getElementById(id); if(!el) return; el.textContent=msg||''; }
    async function submitReset(){
        const token = document.getElementById('resetToken').value.trim();
        const pw = document.getElementById('newPassword').value;
        const cpw = document.getElementById('confirmPassword').value;
        const msg = document.getElementById('resetMsg');
        let ok = true;
        setErr('resetPwErr', !pw? 'Password is required':''); if(!pw) ok=false;
        setErr('resetConfirmErr', (!cpw? 'Confirm your password': (cpw!==pw? 'Passwords do not match':''))); if(!cpw || cpw!==pw) ok=false;
        if(!ok) return;
        msg.textContent='Updating...';
        try{
            const res = await fetch('/api/password/reset', {
                method:'POST',
                headers:{'Content-Type':'application/json'},
                body: JSON.stringify({token, password: pw})
            });
            const data = await res.json();
            if(!res.ok || !data.success){
                msg.textContent = data.message || 'Reset failed';
                return;
            }
            msg.textContent = 'Password updated. You can now log in.';
            setTimeout(() => { window.location.href = '/'; }, 1200);
        }catch(e){
            msg.textContent = 'Network error';
        }
    }
    </script>
</body>
</html>
